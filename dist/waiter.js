(function(){var t={}.hasOwnProperty,e=function(e,r){function o(){this.constructor=e}for(var n in r)t.call(r,n)&&(e[n]=r[n]);return o.prototype=r.prototype,e.prototype=new o,e.__super__=r.prototype,e};Backbone.WaiterHeaderView=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype.tagName="tr",r.prototype.events={"click th.sortable":"sort"},r.prototype.current_sort={by:null,direction:null},r.prototype.initialize=function(t){return this.config=t.config,null!=t.config.default_sort?this.current_sort=t.config.default_sort:void 0},r.prototype.sort=function(t){var e;return e=$(t.currentTarget).index(),this.current_sort.direction=this.current_sort.by===e&&"down"===this.current_sort.direction?"up":"down",this.current_sort.by=e,this.trigger("resort",this.current_sort)},r.prototype.render=function(){var t=this;return this.$el.empty(),_.each(this.config.columns,function(e,r){var o;return o=e.sortable?"sortable":"",t.current_sort.by===r&&"up"===t.current_sort.direction&&(o+=" sorted up"),t.current_sort.by===r&&"down"===t.current_sort.direction&&(o+=" sorted down"),t.$el.append("<th class='"+o+"'>"+e.name+"</th>")}),this.delegateEvents(),this},r}(Backbone.View),Backbone.WaiterRowView=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype.tagName="tr",r.prototype.initialize=function(t){return this.listenTo(this.model,"change",this.render),this.config=t.config,this.render()},r.prototype.render=function(){var t=this;return this.$el.empty(),_.each(this.config.columns,function(e){return t.$el.append(new e.cellView({value:e.value(t.model),model:t.model}).render().el)}),this},r}(Backbone.View),Backbone.WaiterCellView=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype.tagName="td",r.prototype.initialize=function(t){return this.value=t.value},r.prototype.render=function(){return this.$el.html(this.value),this},r}(Backbone.View),Backbone.Waiter=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype.tagName="table",r.prototype.config={headerView:null,rowView:null,columns:[]},r.prototype._compose_fn=function(t){return _.isString(t)?function(e){return e.get(t)}:function(e){return t.call(e)}},r.prototype.setup=function(t){var e=this;return this.config={headerView:t.headerView||Backbone.WaiterHeaderView,rowView:t.rowView||Backbone.WaiterRowView,default_sort:{by:t.default_sort||0,direction:t.default_sort_direction||"down"},columns:_(t.columns).chain().map(function(t){var r;if(t.name)return r={name:t.name,value:e._compose_fn(t.value||t.name),sortable:t.sort!==!1?!0:!1,cellView:t.cellView||Backbone.WaiterCellView},r.sortable&&(r.sortBy=t.sort?e._compose_fn(t.sort):r.value),r}).compact().value()}},r.prototype.resort=function(t){return this.collection.comparator=this.config.columns[t.by].sortBy,this.collection.sort({quiet:!0}),"up"===t.direction&&this.collection.models.reverse(),this.collection.trigger("sort")},r.prototype.initialize=function(t){return this.listenTo(this.collection,"reset sort change",this.render),this.config=this.setup(t),this.headerView=new this.config.headerView({config:this.config}),this.listenTo(this.headerView,"resort",this.resort),this.resort(this.config.default_sort)},r.prototype.render=function(){var t=this;return this.$el.empty(),this.$el.append(this.headerView.render().el),this.collection.each(function(e){return t.$el.append(new t.config.rowView({model:e,config:t.config}).render().el)}),this},r}(Backbone.View)}).call(this);